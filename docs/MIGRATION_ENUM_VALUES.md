# –ú–∏–≥—Ä–∞—Ü–∏—è enum –∑–Ω–∞—á–µ–Ω–∏–π –≤ enum_values

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–î–æ (v1.0):**
```json
{
  "0": "–í—ã–∫–ª—é—á–µ–Ω–æ",
  "1": "–í–∫–ª—é—á–µ–Ω–æ",
  "icon": "fas fa-power-off",
  "color": "#4CAF50"
}
```

**–ü–æ—Å–ª–µ (v2.0):**
```json
{
  "enum_values": {
    "0": "–í—ã–∫–ª—é—á–µ–Ω–æ",
    "1": "–í–∫–ª—é—á–µ–Ω–æ"
  },
  "icon": "fas fa-power-off",
  "color": "#4CAF50"
}
```

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ –∫–ª—é—á–∏ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏—è enum, –≤–∫–ª—é—á–∞—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ:

```json
{
  "enum_values": {
    "icon": "–ò–∫–æ–Ω–∫–∞",
    "color": "–¶–≤–µ—Ç",
    "min": "–ú–∏–Ω–∏–º—É–º",
    "max": "–ú–∞–∫—Å–∏–º—É–º",
    "read_only": "–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ"
  },
  "icon": "fas fa-palette",
  "color": "#FF5722"
}
```

–ë–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤!

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö enum —Å–≤–æ–π—Å—Ç–≤:

```python
"""
–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ enum –∑–Ω–∞—á–µ–Ω–∏–π –≤ params["enum_values"]
–ó–∞–ø—É—Å—Ç–∏—Ç—å: python migrate_enum_params.py
"""

import json
from app.database import session_scope
from app.core.models.Clasess import Property

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–ª—é—á–∏
SYSTEM_KEYS = {
    'icon', 'color', 'sort_order', 'default_value', 'read_only',
    'min', 'max', 'decimals', 'regexp', 'enum_values'
}

def migrate_enum_properties():
    """–ú–∏–≥—Ä–∞—Ü–∏—è enum —Å–≤–æ–π—Å—Ç–≤ –≤ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É"""
    
    with session_scope() as session:
        # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ enum —Å–≤–æ–π—Å—Ç–≤–∞
        enum_properties = session.query(Property).filter(
            Property.type == 'enum',
            Property.params.isnot(None)
        ).all()
        
        migrated_count = 0
        
        for prop in enum_properties:
            try:
                params = json.loads(prop.params)
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ —É–∂–µ
                if 'enum_values' in params:
                    print(f"  –ü—Ä–æ–ø—É—â–µ–Ω–æ (—É–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ): {prop.name}")
                    continue
                
                # –ò–∑–≤–ª–µ—á—å enum –∑–Ω–∞—á–µ–Ω–∏—è (–≤—Å–µ –Ω–µ-—Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–ª—é—á–∏)
                enum_values = {}
                new_params = {}
                
                for key, value in params.items():
                    if key in SYSTEM_KEYS:
                        new_params[key] = value
                    else:
                        enum_values[key] = value
                
                # –ï—Å–ª–∏ –µ—Å—Ç—å enum –∑–Ω–∞—á–µ–Ω–∏—è, —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                if enum_values:
                    new_params['enum_values'] = enum_values
                    prop.params = json.dumps(new_params)
                    migrated_count += 1
                    print(f"‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: {prop.name}")
                    print(f"   –ó–Ω–∞—á–µ–Ω–∏–π: {len(enum_values)}")
                else:
                    print(f"‚ö†Ô∏è  –ù–µ—Ç enum –∑–Ω–∞—á–µ–Ω–∏–π: {prop.name}")
                
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ {prop.name}: {e}")
        
        if migrated_count > 0:
            session.commit()
            print(f"\nüéâ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤: {migrated_count}")
        else:
            print("\n‚ú® –ù–µ—Ç —Å–≤–æ–π—Å—Ç–≤ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏")

if __name__ == '__main__':
    print("=" * 60)
    print("–ú–∏–≥—Ä–∞—Ü–∏—è enum —Å–≤–æ–π—Å—Ç–≤ –≤ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É")
    print("=" * 60)
    print()
    migrate_enum_properties()
```

## –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ —É –≤–∞—Å –º–∞–ª–æ enum —Å–≤–æ–π—Å—Ç–≤, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ enum —Å–≤–æ–π—Å—Ç–≤–∞
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª—è "Enum Values (JSON)"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (JavaScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–µ—Ä–Ω–µ—Ç –≤ `enum_values`)

## ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞!

**–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!**

–í—Å–µ enum —Å–≤–æ–π—Å—Ç–≤–∞ **–¥–æ–ª–∂–Ω—ã** –∏–º–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å `enum_values`:

```json
{
  "enum_values": {
    "0": "Value",
    "1": "Value2"
  },
  "icon": "...",
  "color": "..."
}
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏:**

- ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ùå `data="text"` –Ω–µ –≤–µ—Ä–Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ
- ‚ùå API –Ω–µ –≤–µ—Ä–Ω–µ—Ç `enum_values`
- ‚ö†Ô∏è –ë—É–¥—É—Ç warnings –≤ –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–º. –≤—ã—à–µ) –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
from app.core.lib.object import getObject

# –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç —Å enum —Å–≤–æ–π—Å—Ç–≤–æ–º
obj = getObject("MyObject")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
status = obj.getProperty("status")
print(f"Status value: {status}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
status_text = obj.getProperty("status", data="text")
print(f"Status text: {status_text}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
prop = obj.properties["status"]
print(f"Params: {prop.params}")
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: {"enum_values": {...}, "icon": "...", ...}
```

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ß—Ç–æ –µ—Å–ª–∏ —è –Ω–µ –º–∏–≥—Ä–∏—Ä—É—é —Å—Ç–∞—Ä—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞?**  
A: –û–Ω–∏ –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –í–∞–ª–∏–¥–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π —á–µ—Ä–µ–∑ `data="text"` –∏ API –Ω–µ –±—É–¥—É—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å. –ú–∏–≥—Ä–∞—Ü–∏—è **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞**.

**Q: –ú–æ–≥—É –ª–∏ —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤?**  
A: –ù–µ—Ç! –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å `enum_values`. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ API –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —É –º–µ–Ω—è enum –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –∫–ª—é—á–æ–º?**  
A: –¢–µ–ø–µ—Ä—å —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ! –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –∏ –±—ã–ª–∞ —Å–¥–µ–ª–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è.

## –ü—Ä–∏–º–µ—Ä –¥–æ –∏ –ø–æ—Å–ª–µ

**–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç):**
```json
{
  "off": "–í—ã–∫–ª—é—á–µ–Ω–æ",
  "on": "–í–∫–ª—é—á–µ–Ω–æ",
  "icon": "–ò–∫–æ–Ω–∫–∞ —Ä–µ–∂–∏–º–∞",  // –ö–û–ù–§–õ–ò–ö–¢ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º!
  "color": "#4CAF50"         // –ö–û–ù–§–õ–ò–ö–¢ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º!
}
```

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ):**
```json
{
  "enum_values": {
    "off": "–í—ã–∫–ª—é—á–µ–Ω–æ",
    "on": "–í–∫–ª—é—á–µ–Ω–æ",
    "icon": "–ò–∫–æ–Ω–∫–∞ —Ä–µ–∂–∏–º–∞",  // –¢–µ–ø–µ—Ä—å —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ enum –∑–Ω–∞—á–µ–Ω–∏–µ
    "min": "–ú–∏–Ω–∏–º—É–º",         // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    "max": "–ú–∞–∫—Å–∏–º—É–º"
  },
  "icon": "fas fa-toggle-on",  // –°–∏—Å—Ç–µ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è UI
  "color": "#4CAF50"           // –°–∏—Å—Ç–µ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è UI
}
```
