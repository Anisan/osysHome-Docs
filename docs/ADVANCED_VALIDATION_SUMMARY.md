# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 4 –Ω–æ–≤—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–æ–≤:

### 1. **step** - –î–∏—Å–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è `int` –∏ `float`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—Ç–Ω–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–Ω–æ–º—É —à–∞–≥—É
- ‚úÖ –£—á–µ—Ç –±–∞–∑–æ–≤–æ–π —Ç–æ—á–∫–∏ (min –∏–ª–∏ 0)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ –¥–ª—è float (1e-9)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "min": 0,
  "max": 100,
  "step": 10
}
```
–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 0, 10, 20, 30, ..., 100

---

### 2. **allowed_values** - –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫—Ä–æ–º–µ enum
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "allowed_values": [1, 2, 3, 5, 10]
}
```
–¢–æ–ª—å–∫–æ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã

---

### 3. **rate_limit** - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ—Å—Ç–∞–≤—à–∏–º—Å—è –≤—Ä–µ–º–µ–Ω–µ–º –æ–∂–∏–¥–∞–Ω–∏—è
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä `bypass_rate_limit` –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "rate_limit": 5.0
}
```
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 5 —Å–µ–∫—É–Ω–¥

---

### 4. **depends_on** - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–≤–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ 8 —Ç–∏–ø–æ–≤ —É—Å–ª–æ–≤–∏–π: equals, not_equals, greater_than, less_than, greater_or_equal, less_or_equal, in, not_in
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "depends_on": {
    "property": "enabled",
    "value": true,
    "condition": "equals",
    "error_message": "–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ"
  }
}
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ `app/core/main/ObjectManager.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ 4 –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - –ú–µ—Ç–æ–¥ `_decodeValue()` - step, allowed_values
  - –ú–µ—Ç–æ–¥ `setValue()` - rate_limit
  - –ú–µ—Ç–æ–¥—ã `_validate_dependencies()`, `_validate_single_dependency()` - depends_on
  - –ú–µ—Ç–æ–¥ `to_dict()` - –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–≤–æ–¥ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –¢–µ—Å—Ç—ã
- ‚úÖ `tests/test_advanced_validation.py` - 600+ —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤
  - `TestStepValidation` - 4 —Ç–µ—Å—Ç–∞ –¥–ª—è step
  - `TestAllowedValues` - 4 —Ç–µ—Å—Ç–∞ –¥–ª—è allowed_values
  - `TestRateLimit` - 3 —Ç–µ—Å—Ç–∞ –¥–ª—è rate_limit
  - `TestDependsOn` - 3 —Ç–µ—Å—Ç–∞ –¥–ª—è depends_on
  - `TestCombinedValidations` - —Ç–µ—Å—Ç—ã –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

### –ü—Ä–∏–º–µ—Ä—ã
- ‚úÖ `examples/advanced_validation_examples.py` - 700+ —Å—Ç—Ä–æ–∫ –ø—Ä–∏–º–µ—Ä–æ–≤
  - 10 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
  - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `PARAMS_DOCUMENTATION.md` - —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
  - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
  - –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π

- ‚úÖ `docs/ADVANCED_VALIDATION_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ—Ä—è–¥–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ `read_only`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `rate_limit`
3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ `min`/`max`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ `step`
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ `decimals`
7. –ü—Ä–æ–≤–µ—Ä–∫–∞ `regexp` / `enum_values`
8. –ü—Ä–æ–≤–µ—Ä–∫–∞ `allowed_values`
9. –ü—Ä–æ–≤–µ—Ä–∫–∞ `depends_on`

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ `init=True` (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î)
- `rate_limit` –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ —Å –ø–æ–º–æ—â—å—é `bypass_rate_limit=True`
- `depends_on` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ø–∏—Å–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è)
- `step` —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è float
- `allowed_values` –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ enum (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `enum_values`)

### API Response
–í—Å–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç API:
```json
{
  "name": "temperature",
  "type": "float",
  "value": 22.0,
  "min": 18.0,
  "max": 30.0,
  "step": 0.5,
  "allowed_values": [18.0, 18.5, 19.0, ...],
  "rate_limit": 10.0,
  "depends_on": {...}
}
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –¢–µ—Ä–º–æ—Å—Ç–∞—Ç —Å –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å—é
```python
from app.core.lib.object import addObject, addObjectProperty, setProperty
import json

obj = addObject("thermostat", "Thermostat", "–£–º–Ω—ã–π —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç")
addObjectProperty("target_temp", "thermostat", "–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", type=PropertyType.Float)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
params = {
    "min": 18.0,
    "max": 30.0,
    "step": 0.5,
    "decimals": 1,
    "icon": "thermometer"
}
# –û–±–Ω–æ–≤–∏—Ç—å params –≤ –ë–î...

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
setProperty("thermostat.target_temp", 22.5)  # OK
setProperty("thermostat.target_temp", 22.3)  # ValueError: not aligned with step
```

### –ü—Ä–∏–º–µ—Ä 2: –ö–Ω–æ–ø–∫–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—Ä–µ–±–µ–∑–≥–∞
```python
params = {
    "rate_limit": 2.0  # 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –Ω–∞–∂–∞—Ç–∏—è–º–∏
}

setProperty("button.pressed", True)   # OK
time.sleep(1)
setProperty("button.pressed", True)   # ValueError: wait 1.0 more seconds
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–æ—â–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞
```python
# –°–≤–æ–π—Å—Ç–≤–æ power
params = {
    "min": 0,
    "max": 2000,
    "depends_on": {
        "property": "mode",
        "value": "manual",
        "condition": "equals",
        "error_message": "–ò–∑–º–µ–Ω—è–π—Ç–µ –º–æ—â–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ"
    }
}

setProperty("heater.mode", "auto")
setProperty("heater.power", 1500)  # ValueError: –ò–∑–º–µ–Ω—è–π—Ç–µ –º–æ—â–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
```

---

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π
python -m pytest tests/test_advanced_validation.py -v

# –∏–ª–∏ —á–µ—Ä–µ–∑ unittest
python -m unittest tests.test_advanced_validation -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤
python -m pytest tests/test_advanced_validation.py::TestStepValidation -v
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `PARAMS_DOCUMENTATION.md`
- **–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞:** `examples/advanced_validation_examples.py`
- **–¢–µ—Å—Ç—ã:** `tests/test_advanced_validation.py`
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `app/core/main/ObjectManager.py`

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
2. **–£–¥–æ–±—Å—Ç–≤–æ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é
3. **–ì–∏–±–∫–æ—Å—Ç—å:** –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
6. **IoT-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —É–º–Ω–æ–≥–æ –¥–æ–º–∞

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.
–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —Å–≤–æ–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!
